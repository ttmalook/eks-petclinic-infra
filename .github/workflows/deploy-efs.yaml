# Read and enhance the uploaded deploy-efs.yaml file with proper kubeconfig step and full Korean comments
from pathlib import Path

input_path = Path("/mnt/data/deploy-efs.yaml")
output_path = Path("/mnt/data/deploy-efs-commented.yaml")

enhanced_content = """
# GitHub Actions Workflow: EFS 기반 스토리지 구성 자동화
# 이 워크플로는 .github/workflows/deploy-efs.yaml 에 정의되며,
# EFS용 StorageClass, PersistentVolume, PVC를 자동 생성합니다.

name: Deploy EFS Storage

on:
  workflow_dispatch:  # 수동 실행을 허용합니다

jobs:
  efs-setup:
    runs-on: ubuntu-latest  # GitHub Actions 기본 런타임 환경 사용

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3  # GitHub 저장소 코드 체크아웃

    - name: Configure AWS credentials
      uses: aws-actions/configure-aws-credentials@v2  # AWS 인증 정보 설정
      with:
        aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
        aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        aws-region: ap-northeast-2

    - name: Set up kubectl
      uses: azure/setup-kubectl@v3
      with:
        version: v1.27.1  # kubectl 버전 지정

    - name: Configure kubeconfig for EKS
      run: |
        # GitHub Actions 내 kubectl이 EKS 클러스터와 통신할 수 있도록 설정
        aws eks --region ap-northeast-2 update-kubeconfig --name petclinic-cluster

    - name: Apply EFS StorageClass, PV, PVC
      run: |
        # 정의된 EFS 관련 리소스들을 클러스터에 적용
        kubectl apply -f efs/storageclass.yaml
        kubectl apply -f efs/pv.yaml
        kubectl apply -f efs/pvc.yaml
"""

output_path.write_text(enhanced_content.strip(), encoding="utf-8")
output_path.name
